{"version":3,"sources":["api/contact/contact.controller.js"],"names":["syncContact","handleError","res","argStatusCode","err","error","statusCode","status","send","updateContacts","contacts","userId","groupId","contact","shift","name","number","email","birthday","Contact","find","where","then","item","update","resolve","create","contactId","id","GroupContact","data","catch","req","body","json","message","Group","findOrCreate","user","group","end","console","log"],"mappings":"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","file":"contact.controller.js","sourcesContent":["import logger from '../../components/logger';\nimport db from '../../conn/sqldb';\n\nfunction handleError(res, argStatusCode, err) {\n  logger.error('user.controller', err);\n  const statusCode = argStatusCode || 500;\n  res.status(statusCode).send(err);\n}\n\nfunction updateContacts({ contacts, userId, groupId }) {\n  const contact = contacts.shift();\n  if (contact) {\n    const { name, number, email, birthday } = contact;\n    return db.Contact.find({ where: { number, userId } })\n      .then(item => (item\n        ? item.update({ name, email, birthday }).then(() => Promise.resolve(item))\n        : db.Contact.create({ name, number, userId, email, birthday })))\n      .then(({ id: contactId }) => db.GroupContact\n        .find({ where: { groupId, contactId } })\n        .then(data => (data ? Promise.resolve() : db.GroupContact.create({ groupId, contactId }))))\n      .then(() => updateContacts({ contacts, userId, groupId }))\n      .catch(() => updateContacts({ contacts, userId, groupId }));\n  }\n  return Promise.resolve();\n}\n\nexport function syncContact(req, res) {\n  const { name, contacts } = req.body;\n  if (!name || !contacts) return res.status(500).json({ message: 'Invalid Request' });\n  db.Group\n    .findOrCreate({ where: { name, userId: req.user.id } })\n    .then(([group]) => updateContacts({ contacts, userId: req.user.id, groupId: group.id }))\n    .then(() => res.end())\n    .catch(err => console.log(err));\n  return res.end();\n}\n"]}