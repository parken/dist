{"version":3,"sources":["api/route/routes.controller.js"],"names":["index","handleError","res","argStatusCode","err","error","statusCode","status","send","req","Route","findAll","then","json","routes","map","x","toJSON","filter","route","balance","user","roleId","id","catch"],"mappings":";;;;;QAUgBA,K,GAAAA,K;;AAVhB;;;;AACA;;AACA;;;;;;AAEA,SAASC,WAAT,CAAqBC,GAArB,EAA0BC,aAA1B,EAAyCC,GAAzC,EAA8C;AAC5C,kBAAOC,KAAP,CAAa,iBAAb,EAAgCD,GAAhC;AACA,MAAME,aAAaH,iBAAiB,GAApC;AACAD,MAAIK,MAAJ,CAAWD,UAAX,EAAuBE,IAAvB,CAA4BJ,GAA5B;AACD;;AAEM,SAASJ,KAAT,CAAeS,GAAf,EAAoBP,GAApB,EAAyB;AAC9B,SAAO,gBAAGQ,KAAH,CAASC,OAAT,GACJC,IADI,CACC;AAAA,WAAUV,IAAIW,IAAJ,CAASC,OAAOC,GAAP,CAAW;AAAA,aAAKC,EAAEC,MAAF,EAAL;AAAA,KAAX,EAA4BC,MAA5B,CAAmC,aAAK;AAC/D,UAAMC,QAAQH,CAAd;AACAG,YAAMC,OAAN,GAAgBX,IAAIY,IAAJ,EAAYZ,IAAIY,IAAJ,CAASC,MAAT,KAAoB,CAApB,GAAwB,SAAxB,GAAoC,SAAhD,gBACN,0BAAaN,EAAEO,EAAf,CADM,CAAhB;AAEA,aAAOJ,MAAMC,OAAb;AACD,KALwB,CAAT,CAAV;AAAA,GADD,EAOJI,KAPI,CAOE;AAAA,WAAOvB,YAAYC,GAAZ,EAAiB,GAAjB,EAAsBE,GAAtB,CAAP;AAAA,GAPF,CAAP;AAQD","file":"routes.controller.js","sourcesContent":["import logger from '../../components/logger/index';\nimport { getRouteType } from '../../conn/sqldb/helper';\nimport db from '../../conn/sqldb/index';\n\nfunction handleError(res, argStatusCode, err) {\n  logger.error('user.controller', err);\n  const statusCode = argStatusCode || 500;\n  res.status(statusCode).send(err);\n}\n\nexport function index(req, res) {\n  return db.Route.findAll()\n    .then(routes => res.json(routes.map(x => x.toJSON()).filter(x => {\n      const route = x;\n      route.balance = req.user[`${req.user.roleId === 4 ? 'selling' : 'sending'\n      }Balance${getRouteType(x.id)}`];\n      return route.balance;\n    })))\n    .catch(err => handleError(res, 500, err));\n}\n"]}