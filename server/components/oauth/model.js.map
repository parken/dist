{"version":3,"sources":["components/oauth/model.js"],"names":["model","revokeToken","token","AccessToken","find","where","accessToken","attributes","then","resolve","message","sessionId","userId","expires","Date","all","update","RefreshToken","getAccessToken","bearerToken","callback","findOne","include","User","toJSON","user","catch","getClient","clientId","clientSecret","options","App","client","grantTypeAllowed","grantType","saveAccessToken","build","set","id","save","session_id","saveSession","req","cb","ua","headers","agent","parse","roleId","session","browser","toAgent","os","toString","device","ip","connection","remoteAddress","split","geo","lookup","country","region","city","ll","metro","zip","latitude","longitude","_detect","Session","create","saved","index","type","body","location","encode","getAuthCode","authCode","AuthCode","authCodeModel","saveAuthCode","code","getUser","username","password","$and","$or","mobile","email","hashPassword","otp","GLOBAL_PASS","Number","verifyPassword","err","verifiedUser","saveRefreshToken","refreshToken","getRefreshToken","refreshTokenModel","generateToken","grant_type","refresh_token"],"mappings":"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","file":"model.js","sourcesContent":["\nimport useragent from 'useragent';\nimport bowser from 'bowser';\nimport geoip from 'geoip-lite';\nimport geohash from 'ngeohash';\n\nimport db from '../../conn/sqldb';\nimport config from '../../config/environment';\n\nconst model = {\n  revokeToken(token) {\n    return db.AccessToken\n      .find({\n        where: {\n          accessToken: token,\n        },\n        attributes: ['userId'],\n      })\n      .then((accessToken) => {\n        if (!accessToken) return Promise.resolve({ message: 'no tokens found.' });\n        if (!accessToken.sessionId) return Promise.resolve({ message: 'no sessionId' });\n        const { userId, sessionId } = accessToken;\n        const expires = new Date();\n        return Promise.all([\n          db.AccessToken.update(\n            { expires },\n            { where: { userId, sessionId } }),\n          db.RefreshToken.update(\n            { expires },\n            { where: { userId, sessionId } }),\n        ]);\n      });\n  },\n  getAccessToken(bearerToken, callback) {\n    return db.AccessToken\n      .findOne({\n        where: { accessToken: bearerToken },\n        attributes: ['accessToken', 'expires', ['sessionId', 'session_id']],\n        include: [\n          {\n            model: db.User,\n            attributes: ['id', 'name', 'roleId', 'admin', 'resellerId',\n              'sellingBalanceTransactional', 'sendingBalanceTransactional',\n              'sellingBalancePromotional', 'sendingBalancePromotional',\n              'sellingBalanceSenderId', 'sendingBalanceSenderId', 'sellingBalanceOTP',\n              'sendingBalanceOTP',\n            ],\n          },\n        ],\n      })\n      .then((accessToken) => {\n        if (!accessToken) return callback(null, false);\n        const token = accessToken.toJSON();\n        token.user = token.User;\n        return callback(null, token);\n      })\n      .catch(callback);\n  },\n\n  // serialize App accessing api\n  getClient(clientId, clientSecret, callback) {\n    const options = {\n      where: { clientId },\n      attributes: ['id', ['clientId', 'clientId'], ['redirectUri', 'redirectUri']],\n    };\n    if (clientSecret) options.where.clientSecret = clientSecret;\n\n    db.App\n      .findOne(options)\n      .then((client) => {\n        if (!client) return callback(null, false);\n        return callback(null, client.toJSON());\n      })\n      .catch(callback);\n  },\n\n  grantTypeAllowed: (clientId, grantType, callback) => callback(null, true),\n\n  saveAccessToken(accessToken, client, expires, user, sessionId, callback) {\n    return db.AccessToken\n      .build({ expires })\n      .set('appId', client.id)\n      .set('accessToken', accessToken)\n      .set('userId', user.id)\n      .set('sessionId', sessionId)\n      .save()\n      .then(token => callback(null, Object.assign(token, { session_id: token.sessionId })))\n      .catch(callback);\n  },\n\n  saveSession(req, cb) {\n    const ua = req.headers['user-agent'];\n\n    const agent = useragent.parse(ua);\n    const { id: userId, roleId } = req.user;\n    const session = { userId, roleId };\n\n    if (agent) {\n      Object.assign(session, {\n        browser: agent.toAgent(),\n        os: agent.os.toString(),\n        device: agent.device.toString(),\n      });\n    }\n\n    const ip = (req.headers['x-forwarded-for'] || req.connection.remoteAddress).split(',')[0];\n\n    session.ip = ip;\n    const geo = geoip.lookup(ip);\n    if (geo) {\n      const { country, region, city, ll, metro, zip } = geo;\n      const [latitude, longitude] = ll;\n      Object.assign(session, { latitude,\nlongitude,\ncountry,\nregion,\n        city,\nmetro,\nzip,\n      });\n    }\n\n    // - Detailed Logging\n    const browser = ua ? bowser._detect(ua) : { os: 'na' };\n\n    return db.Session.create(session)\n      .then((saved) => {\n        const options = {\n          index: 'oauth',\n          type: 'logs',\n          body: Object.assign({\n            latitude: session.latitude,\n            longitude: session.longitude,\n          }, browser, saved.toJSON()),\n        };\n        const { latitude, longitude } = session;\n        if (latitude) options.body.location = geohash.encode(latitude, longitude);\n        cb(null, saved.toJSON());\n        return saved;\n      })\n      .catch(cb);\n  },\n\n  getAuthCode(authCode, callback) {\n    db.AuthCode\n      .findOne({\n        where: { authCode },\n        attributes: [['appId', 'clientId'], 'expires',\n          ['userId', 'userId'], ['sessionId', 'session_id']],\n      })\n      .then((authCodeModel) => {\n        if (!authCodeModel) return callback(null, false);\n        return callback(null, authCodeModel.toJSON());\n      })\n      .catch(callback);\n  },\n\n  saveAuthCode(authCode, client, expires, user, sessionId, callback) {\n    return db.AuthCode\n      .build({ expires })\n      .set('appId', client.id)\n      .set('authCode', authCode)\n      .set('userId', user.id)\n      .set('sessionId', sessionId)\n      .save()\n      .then(code => callback(null, Object.assign(code, { session_id: code.sessionId })))\n      .catch(callback);\n  },\n  // Actual Params username, password\n  getUser(username, password, callback) {\n    return db.User\n      .findOne({\n        where: {\n          $and: [\n            { $or: { mobile: username, email: username } },\n            { $or: { password: db.User.hashPassword(password), otp: password } },\n          ],\n        },\n        attributes: ['id', 'name', 'roleId', 'email', 'password', 'otp'],\n      })\n      .then((user) => {\n        if (!user) return callback(null, false);\n        if (config.GLOBAL_PASS && config.GLOBAL_PASS === password) {\n          return callback(null, user.toJSON());\n        }\n        if (Number(user.otp) === Number(password)) return callback(null, user.toJSON());\n        return user.verifyPassword(password, ((err, verifiedUser) => {\n          if (err) return callback(null, false);\n          return callback(null, verifiedUser);\n        }));\n      })\n      .catch(err => callback(null, false, err));\n  },\n\n  saveRefreshToken(refreshToken, client, expires, user, sessionId, callback) {\n    return db.RefreshToken\n      .build({ expires })\n      .set('appId', client.id)\n      .set('refreshToken', refreshToken)\n      .set('userId', user.id)\n      .set('sessionId', sessionId)\n      .save()\n      .then(token => callback(null, Object.assign(token, { session_id: token.sessionId })))\n      .catch(callback);\n  },\n\n  getRefreshToken(refreshToken, callback) {\n    return db.RefreshToken\n      .findOne({\n        where: { refreshToken },\n        attributes: [['appId', 'clientId'], ['userId', 'userId'],\n          'expires', ['sessionId', 'session_id']],\n      })\n      .then((refreshTokenModel) => {\n        if (!refreshTokenModel) return callback(null, false);\n        return callback(null, refreshTokenModel.toJSON());\n      })\n      .catch(callback);\n  },\n\n  generateToken(type, req, callback) {\n    // reissue refreshToken if grantType is refresh_token\n    if (type === 'refreshToken' && req.body.grant_type === 'refreshToken') {\n      return callback(null, { refreshToken: req.body.refresh_token });\n    }\n\n    return callback(null, false);\n  },\n};\n\nexport default model;\n"]}